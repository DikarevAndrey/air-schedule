!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){var r,s,i,o;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
o=function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function s(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var o=RegExp.prototype.test,a=/\S/;function c(e){return!function(e,t){return o.call(e,t)}(a,e)}var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},h=/\s*/,u=/\s+/,d=/\s*=/,p=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function v(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function g(){this.cache={}}v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t,n,s,o=this.cache;if(o.hasOwnProperty(e))t=o[e];else{for(var a,c,l,h=this,u=!1;h;){if(e.indexOf(".")>0)for(a=h.view,c=e.split("."),l=0;null!=a&&l<c.length;)l===c.length-1&&(u=i(a,c[l])||(n=a,s=c[l],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(s))),a=a[c[l++]];else a=h.view[e],u=i(h.view,e);if(u){t=a;break}h=h.parent}o[e]=t}return r(t)&&(t=t.call(this.view)),t},g.prototype.clearCache=function(){this.cache={}},g.prototype.parse=function(t,r){var i=this.cache,o=t+":"+(r||e.tags).join(":"),a=i[o];return null==a&&(a=i[o]=function(t,r){if(!t)return[];var i,o,a,l=[],m=[],g=[],w=!1,y=!1;function b(){if(w&&!y)for(;g.length;)delete m[g.pop()];else g=[];w=!1,y=!1}function E(e){if("string"==typeof e&&(e=e.split(u,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(s(e[0])+"\\s*"),o=new RegExp("\\s*"+s(e[1])),a=new RegExp("\\s*"+s("}"+e[1]))}E(r||e.tags);for(var C,T,L,M,x,_,S=new v(t);!S.eos();){if(C=S.pos,L=S.scanUntil(i))for(var k=0,H=L.length;k<H;++k)c(M=L.charAt(k))?g.push(m.length):y=!0,m.push(["text",M,C,C+1]),C+=1,"\n"===M&&b();if(!S.scan(i))break;if(w=!0,T=S.scan(f)||"name",S.scan(h),"="===T?(L=S.scanUntil(d),S.scan(d),S.scanUntil(o)):"{"===T?(L=S.scanUntil(a),S.scan(p),S.scanUntil(o),T="&"):L=S.scanUntil(o),!S.scan(o))throw new Error("Unclosed tag at "+S.pos);if(x=[T,L,C,S.pos],m.push(x),"#"===T||"^"===T)l.push(x);else if("/"===T){if(!(_=l.pop()))throw new Error('Unopened section "'+L+'" at '+C);if(_[1]!==L)throw new Error('Unclosed section "'+_[1]+'" at '+C)}else"name"===T||"{"===T||"&"===T?y=!0:"="===T&&E(L)}if(_=l.pop())throw new Error('Unclosed section "'+_[1]+'" at '+S.pos);return function(e){for(var t,n=[],r=n,s=[],i=0,o=e.length;i<o;++i)switch((t=e[i])[0]){case"#":case"^":r.push(t),s.push(t),r=t[4]=[];break;case"/":s.pop()[5]=t[2],r=s.length>0?s[s.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],s=0,i=e.length;s<i;++s)(t=e[s])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(m))}(t,r)),a},g.prototype.render=function(e,t,n,r){var s=this.parse(e,r),i=t instanceof m?t:new m(t);return this.renderTokens(s,i,n,e,r)},g.prototype.renderTokens=function(e,t,n,r,s){for(var i,o,a,c="",l=0,h=e.length;l<h;++l)a=void 0,"#"===(o=(i=e[l])[0])?a=this.renderSection(i,t,n,r):"^"===o?a=this.renderInverted(i,t,n,r):">"===o?a=this.renderPartial(i,t,n,s):"&"===o?a=this.unescapedValue(i,t):"name"===o?a=this.escapedValue(i,t):"text"===o&&(a=this.rawValue(i)),void 0!==a&&(c+=a);return c},g.prototype.renderSection=function(e,t,s,i){var o=this,a="",c=t.lookup(e[1]);if(c){if(n(c))for(var l=0,h=c.length;l<h;++l)a+=this.renderTokens(e[4],t.push(c[l]),s,i);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(e[4],t.push(c),s,i);else if(r(c)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,i.slice(e[3],e[5]),function(e){return o.render(e,t,s)}))&&(a+=c)}else a+=this.renderTokens(e[4],t,s,i);return a}},g.prototype.renderInverted=function(e,t,r,s){var i=t.lookup(e[1]);if(!i||n(i)&&0===i.length)return this.renderTokens(e[4],t,r,s)},g.prototype.renderPartial=function(e,t,n,s){if(n){var i=r(n)?n(e[1]):n[e[1]];return null!=i?this.renderTokens(this.parse(i,s),t,n,i):void 0}},g.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},g.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},g.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="3.0.1",e.tags=["{{","}}"];var w=new g;return e.clearCache=function(){return w.clearCache()},e.parse=function(e,t){return w.parse(e,t)},e.render=function(e,t,r,s){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return w.render(e,t,r,s)},e.to_html=function(t,n,s,i){var o=e.render(t,n,s);if(!r(i))return o;i(o)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return l[e]})},e.Scanner=v,e.Context=m,e.Writer=g,e},t&&"string"!=typeof t.nodeName?o(t):(s=[t],void 0===(i="function"==typeof(r=o)?r.apply(t,s):r)||(e.exports=i))},function(e,t){e.exports='<div class="container">\n    <table border="1">\n        <tr>\n            <th>Время</th>\n            <th>Направление</th>\n            <th>Номер рейса</th>\n        </tr>\n        {{#flights}}\n        <tr>\n            <th>{{#departure}}{{formatDate}}{{/departure}}{{#arrival}}{{formatDate}}{{/arrival}}</th>\n            <th>{{thread.short_title}}</th>\n            <th>{{thread.number}}</th>\n        </tr>\n        {{/flights}}\n    </table>\n</div>'},function(e,t){e.exports='<div class="nav">\n    {{> clock }}\n    <div class="search">\n        {{> search }}\n    </div>\n    <div class="container">\n        <h1><a href="/arrival">Прилет</a></h1>\n        <h1><a href="/departure">Вылет</a></h1>\n        <h1><a href="/delays">Задержки</a></h1>\n    </div>\n</div>'},function(e,t){e.exports='<form class="search__form">\n    <input class="search__input" type="text" placeholder="Поиск по номеру рейса">\n    <button class="search__button">Поиск</button>\n</form> '},function(e,t){e.exports='<div class="container">\n    <div class="clock__timer" id="clock">\n    </div>\n</div>'},function(e,t,n){},function(e,t,n){"use strict";n.r(t);class r{constructor(e){this.el=e,this.el.dataset.view=this.constructor.name,this.el.hidden=!0}get active(){return!this.el.hidden}hide(){this.el.hidden=!0}show(e){this.render(e),this.el.hidden=!1}render(){throw new Error("This method must be impemented!")}}class s{constructor(){if(s.__instance)return s.__instance;this.schedule={departure:null,arrival:null},s.__instance=this}getSchedule(e){return this.schedule[e]?(console.log("Schedule from cache."),Promise.resolve(this.schedule[e])):(console.log("Performing api request."),this.downloadSchedule(e).then(e=>e.json()).then(t=>(this.schedule[e]=t.schedule,this.schedule[e])).catch(e=>{console.log(e)}))}getDelays(){let e=new Promise((e,t)=>{const n=[],r=new Date;this.schedule.departure?(this.schedule.departure.forEach(e=>{const t=new Date(e.departure),s=1===Math.floor(2*Math.random());r-t>0&&s&&n.push(e)}),e(n)):this.downloadSchedule("departure").then(e=>e.json()).then(t=>{this.schedule.departure=t.schedule,this.schedule.departure.forEach(e=>{const t=new Date(e.departure),s=1===Math.floor(2*Math.random());r-t>0&&s&&n.push(e)}),e(n)}).catch(e=>{console.log(e)})}),t=new Promise((e,t)=>{const n=[],r=new Date;this.schedule.arrival?(this.schedule.arrival.forEach(e=>{const t=new Date(e.departure),s=1===Math.floor(2*Math.random());r-t>0&&s&&n.push(e)}),e(n)):this.downloadSchedule("arrival").then(e=>e.json()).then(t=>{this.schedule.arrival=t.schedule,this.schedule.arrival.forEach(e=>{const t=new Date(e.departure),s=1===Math.floor(2*Math.random());r-t>0&&s&&n.push(e)}),e(n)}).catch(e=>{console.log(e)})});return Promise.all([e,t])}search(e){e=e.replace(/\s/g,"").toLowerCase();let t=new Promise((t,n)=>{const r=[];this.schedule.departure?(this.schedule.departure.forEach(t=>{-1!==t.thread.number.replace(/\s/g,"").toLowerCase().indexOf(e)&&r.push(t)}),t(r)):this.downloadSchedule("departure").then(e=>e.json()).then(n=>{this.schedule.departure=n.schedule,this.schedule.departure.forEach(t=>{-1!==t.thread.number.replace(/\s/g,"").toLowerCase().indexOf(e)&&r.push(t)}),t(r)}).catch(e=>{console.log(e)})}),n=new Promise((t,n)=>{const r=[];this.schedule.arrival?(this.schedule.arrival.forEach(t=>{-1!==t.thread.number.replace(/\s/g,"").toLowerCase().indexOf(e)&&r.push(t)}),t(r)):this.downloadSchedule("arrival").then(e=>e.json()).then(n=>{this.schedule.arrival=n.schedule,this.schedule.arrival.forEach(t=>{-1!==t.thread.number.replace(/\s/g,"").toLowerCase().indexOf(e)&&r.push(t)}),t(r)}).catch(e=>{console.log(e)})});return Promise.all([t,n])}downloadSchedule(e){return fetch(`/api?event=${e}`,{method:"GET"})}}var i=n(0),o=n.n(i),a=n(1),c=n.n(a);class l extends r{constructor(e){super(e)}render(){this.el.innerHTML="";const e=document.createElement("section");e.dataset.sectionName="departure";const t=document.createElement("div");t.innerHTML='<div class="message">Загрузка</div>',e.appendChild(t.firstChild),this.el.appendChild(e),(new s).getSchedule("departure").then(t=>{const n={flights:t,formatDate:function(){return new Date(this).toLocaleString("ru")}},r=document.createElement("div");r.innerHTML=o.a.render(c.a,n),e.innerHTML="",e.appendChild(r.firstChild),this.el.appendChild(e)}).catch(e=>{console.log(e)}),o.a.parse(c.a)}}class h{constructor(e){if(h.__instance)return h.__instance;this.routes={},this.root=e,h.__instance=this}register(e,t){return this.routes[e]={View:t,view:null,el:null},this}open(e,t){const n=this.routes[e];if(!n)return void this.open("/");if(null===n.View)return void this.open("/");window.location.pathname!==e&&window.history.pushState(null,"",e);let{View:r,view:s,el:i}=n;i||(i=document.createElement("section"),this.root.appendChild(i)),s||(s=new r(i)),s.active||Object.values(this.routes).forEach(({view:e})=>{e&&e.active&&e.hide()}),s.show(t),this.routes[e]={View:r,view:s,el:i}}start(){this.root.addEventListener("click",function(e){if(!(e.target instanceof HTMLAnchorElement))return;e.preventDefault();const t=e.target;console.log({pathname:t.pathname}),this.open(t.pathname)}.bind(this)),window.addEventListener("popstate",function(){const e=window.location.pathname;this.open(e)}.bind(this));const e=window.location.pathname;this.open(e)}}var u=n(2),d=n.n(u),p=n(3),f=n.n(p),v=n(4),m=n.n(v);function g(e){return e<10&&(e="0"+e),e}n(5);"localhost"!==window.location.hostname&&(console.log=(()=>{}));const w=document.getElementById("root"),y=document.createElement("section");y.dataset.sectionName="nav";const b=document.createElement("div");b.innerHTML=o.a.render(d.a,{},{search:f.a,clock:m.a}),y.appendChild(b.firstChild),w.appendChild(y),window.router=new h(w),window.router.register("/",l).register("/departure",l).register("/arrival",class extends r{constructor(e){super(e)}render(){this.el.innerHTML="";const e=document.createElement("section");e.dataset.sectionName="arrival";const t=document.createElement("div");t.innerHTML='<div class="message">Загрузка</div>',e.appendChild(t.firstChild),this.el.appendChild(e),(new s).getSchedule("arrival").then(t=>{const n={flights:t,formatDate:function(){return new Date(this).toLocaleString("ru")}},r=document.createElement("div");r.innerHTML=o.a.render(c.a,n),e.innerHTML="",e.appendChild(r.firstChild),this.el.appendChild(e)}).catch(e=>{console.log(e)}),o.a.parse(c.a)}}).register("/delays",class extends r{constructor(e){super(e)}render(){this.el.innerHTML="";const e=document.createElement("section");e.dataset.sectionName="delays";const t=document.createElement("div");t.innerHTML='<div class="message">Загрузка</div>',e.appendChild(t.firstChild),this.el.appendChild(e),(new s).getDelays().then(t=>{const n={flights:t=t[0].concat(t[1]),formatDate:function(){return new Date(this).toLocaleString("ru")}},r=document.createElement("div");r.innerHTML=o.a.render(c.a,n),e.innerHTML="",e.appendChild(r.firstChild),this.el.appendChild(e)}).catch(e=>{console.log(e)}),o.a.parse(c.a)}}).register("/search",class extends r{constructor(e){super(e)}render(e){this.el.innerHTML="";const t=document.createElement("section");t.dataset.sectionName="search";const n=document.createElement("div");if(n.innerHTML='<div class="message">Выполняется поиск</div>',t.appendChild(n.firstChild),this.el.appendChild(t),!e){const t=new URLSearchParams(window.location.href.split("?")[1]);e=t.get("search")}const r=new s;e?r.search(e).then(n=>{if((n=n[0].concat(n[1])).length>0){const r={flights:n,formatDate:function(){return new Date(this).toLocaleString("ru")}},s=document.createElement("div");s.innerHTML=o.a.render(c.a,r),t.innerHTML=`<div class="message">Результаты поиска по запросу &nbsp<b>${e}</b>:</div>`,t.appendChild(s.firstChild),this.el.appendChild(t)}else this.noEntriesFound(t,e)}).catch(e=>{console.log(e)}):this.noEntriesFound(t,e),o.a.parse(c.a)}noEntriesFound(e,t){const n=document.createElement("div");/^\s+$/.test(t)||!t?n.innerHTML='<div class="message">Пустой поисковый запрос</div>':n.innerHTML=`<div class="message">По запросу &nbsp<b>${t}</b>&nbsp ничего не нашлось</div>`,e.innerHTML="",e.appendChild(n.firstChild),this.el.appendChild(e)}hide(){super.hide(),this.el.innerHTML=""}}),window.router.start(),document.getElementsByClassName("search__button")[0].addEventListener("click",e=>{e.preventDefault();const t=document.getElementsByClassName("search__input")[0],n=t.value;t.value="",router.open("/search",n)}),function e(t){const n=new Date;let r=n.getHours(),s=n.getMinutes(),i=n.getSeconds();s=g(s),i=g(i),document.getElementById(t).innerHTML=`${r}:${s}:${i}`,setTimeout(()=>{e(t)},500)}("clock")}]);